'use client';
import { jsx } from 'react/jsx-runtime';
import { useState, useRef, useCallback } from 'react';
import { clsx } from '../../node_modules/clsx/dist/lite.js';
import { usePrevious } from '../../hooks/usePrevious.js';
import { useMediaQuery } from '../../hooks/useMediaQuery.js';

const transitionDurationInMilliseconds = 250;
/**
 * AnimateHeight is a component that animates its height when the `open` prop changes.
 */
const AnimateHeight = ({ children, className, open = false, style, ...rest }) => {
    const [height, setHeight] = useState(0);
    const prevOpen = usePrevious(open);
    const openOrClosed = open ? 'open' : 'closed';
    const [state, setState] = useState(openOrClosed);
    const timeoutRef = useRef(null);
    const shouldAnimate = !useMediaQuery('(prefers-reduced-motion)');
    const contentRef = useCallback((node) => {
        if (node) {
            const resizeObserver = new ResizeObserver(() => {
                setHeight(open ? node.getBoundingClientRect().height : 0);
            });
            resizeObserver.observe(node);
        }
        if (prevOpen !== undefined && prevOpen !== open) {
            // Opening or closing
            setState(shouldAnimate ? 'openingOrClosing' : openOrClosed);
            timeoutRef.current && clearTimeout(timeoutRef.current); // Reset timeout if already active (i.e. if the user closes the component before it finishes opening)
            timeoutRef.current = setTimeout(() => {
                setState(openOrClosed);
            }, transitionDurationInMilliseconds);
        }
    }, [open, openOrClosed, prevOpen, shouldAnimate]);
    const transition = state === 'openingOrClosing'
        ? `height ${transitionDurationInMilliseconds}ms ease-in-out`
        : undefined;
    return (jsx("div", { ...rest, className: clsx('fds-animate-height', `fds-animate-height--${state}`, className), style: { height, transition, ...style }, children: jsx("div", { ref: contentRef, className: 'fds-animate-height__content', children: children }) }));
};

export { AnimateHeight };
